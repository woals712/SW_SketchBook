<template>
  <div class="container">
    <div class="form-v4-content">
      <div v-show="errorMessage" class="alert alert-danger failed">{{ errorMessage }}</div>

      <div class="form-left">
        <h2>게시글 만들기</h2>
        <p class="text-1"><span>태그 입력시 주의사항:</span><br>
        원하는 태그를 입력해 주세요<br>
        태그를 입력하고 엔터 버튼을 누르면 추가되며, 지울 수도 있습니다.
        </p>
      </div>

      <form class="form-detail" @submit.prevent="submitForm">
        <h2>게시글 작성 폼</h2>
        <div class="form-group">
          <div class="form-row form-row-2">
            <label for="titleInput">게시글 제목</label>
            <input v-model="articleInfo.title" type="text" class="input-text mb-3" id="titleInput" placeholder="게시글 제목" required>
            <div class="field-error mb-3" v-if="$v.articleInfo.title.$dirty">
              <div style="color:red;" v-if="!$v.articleInfo.title.required">제목을 입력해주세요</div>
            </div>
          </div>
        </div>

        <div class="form-row">
          <label for="contentArea">게시글 내용</label>
          <textarea v-model="articleInfo.content" class="mb-3" id="detailArea" rows="10" style="resize: none;margin-bottom: 25px;"
          placeholder="게시글 내용을 입력해주세요"></textarea>
          <div class="field-error mb-3" v-if="$v.articleInfo.content.$dirty">
            <div style="color:red;" v-if="!$v.articleInfo.content.required">내용을 입력해주세요</div>
          </div>
        </div>
        <div class="form-group">
          <div class="form-row form-row-2">
            <label for="categoryInput">카테고리</label>
            <select class="form-control mb-3" @change="changeJobTitle($event)" id="categoryInput" style="resize: none;margin-bottom: 25px;">
              <option value="" selected disabled>선택</option>
              <option v-for="mycategory in Mycategory" :value="mycategory.name" :key="mycategory.id">{{ mycategory.name }}</option>
              <div class="field-error mb-3" v-if="$v.articleInfo.category.$dirty">
                <div style="color:red;" v-if="!$v.articleInfo.category.required">카테고리를 선택해주세요</div>
              </div>
            </select>
          </div>
        </div>

        <div class="form-row">
          <label for="tagInput">태그</label>
        </div>

        <div class="form-row">
          <input-tag v-model="articleInfo.tagData" id="tagInput" style="resize: none;margin-bottom: 30px;width:100%"></input-tag>
        </div>

        <button @click="CreateArticle" type="button" class="btn btn-primary">작성하기</button>
        <!-- <button type="submit" class="btn btn-primary">작성하기</button> -->
      </form>
    </div>
  </div>
</template>

<script>
import axios from 'axios'
import { required } from 'vuelidate/lib/validators'
import createArticle from '@/services/article'

export default {
  name: 'CreateArticle',
  data () {
    return {
      articleInfo: {
        title: '',
        content: '',
        category: '',
        tagData: []
      },
      Mycategory: [],
      selectedCategory: null,
      errorMessage: ''
    }
  },
  validations: {
    articleInfo: {
      title: { required },
      content: { required },
      category: { required }
    }
  },
  methods: {
    changeJobTitle (event) {
      this.selectedCategory = event.target.options[event.target.options.selectedIndex].text
      this.articleInfo.category = this.selectedCategory
    },
    submitForm () {
      this.$v.$touch()
      if (this.$v.$invalid) {
        return
      }

      createArticle.create(this.form).then(() => {
        this.$swal({
          icon: "success",
          title: "글 작성 완료!",
        })
        this.$router.push({ name: 'home' })
      }).catch((error) => {
        this.errorMessage = 'Failed to create article. ' + error.message
      })
    },
    CreateArticle () {
      this.$v.$touch()
      if (this.$v.$invalid) {
        return
      }

      // this.articleInfo.tagData = this.articleInfo.tagData
      axios.post('/study', this.articleInfo)
        .then((res) => {
          this.$router.push({ name: 'study' })
        })
    }
  },
  created () {
    axios.get(`/${this.$store.state.username}/category`)
      .then(res => {
        this.Mycategory = res.data.categoryList
      })
  }
}
</script>

<style scoped>
body {
  margin: 0;
}

.container {
  width: 100%;
  margin: 0 auto;
  display: flex;
  display: -webkit-flex;
  justify-content: center;
  -o-justify-content: center;
  -ms-justify-content: center;
  -moz-justify-content: center;
  -webkit-justify-content: center;
  align-items: center;
  -o-align-items: center;
  -ms-align-items: center;
  -moz-align-items: center;
  -webkit-align-items: center;
}
.form-v4-content  {
  background: #fff;
  width: 1050px;
  border-radius: 10px;
  -o-border-radius: 10px;
  -ms-border-radius: 10px;
  -moz-border-radius: 10px;
  -webkit-border-radius: 10px;
  box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  -o-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  -ms-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  -moz-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  -webkit-box-shadow: 0px 8px 20px 0px rgba(0, 0, 0, 0.15);
  margin: 30px 0;
  position: relative;
  display: flex;
  display: -webkit-flex;
}
.form-v4-content h2 {
  font-weight: 600;
  font-size: 31px;
  padding: 6px 0 0;
  margin-bottom: 34px;
  color: white;
}
.form-v4-content .form-left {
  background: #3786bd;
  border-top-left-radius: 10px;
  border-bottom-left-radius: 10px;
  padding: 20px 40px;
  position: relative;
  width: 60%;
  color: #fff;
}
.form-v4-content .form-left p {
  font-size: 15px;
  font-weight: 400;
  line-height: 1.5;
}
.form-v4-content .form-left span {
  font-weight: 700;
}
.form-v4-content .form-left .text-2 {
  margin: 20px 0 25px;
}
.form-v4-content .form-left .account {
  background: #fff;
  border-top-left-radius: 5px;
  border-bottom-right-radius: 5px;
  width: 180px;
  border: none;
  margin: 15px 0 50px 0px;
  cursor: pointer;
  color: #333;
  font-weight: 700;
  font-size: 15px;
  font-family: 'Open Sans', sans-serif;
  appearance: unset;
    -moz-appearance: unset;
    -webkit-appearance: unset;
    -o-appearance: unset;
    -ms-appearance: unset;
    outline: none;
    -moz-outline: none;
    -webkit-outline: none;
    -o-outline: none;
    -ms-outline: none;
}
.form-v4-content .form-left .account:hover {
  background: #e5e5e5;
}
.form-v4-content .form-left .form-left-last input {
  padding: 15px;
}
.form-v4-content .form-left .form-left-last textarea {
  padding: 15px;
}
.form-v4-content .form-detail {
  padding: 20px 40px;
  position: relative;
  width: 100%;
}
.form-v4-content .form-detail h2 {
  color: #666;
}
.form-v4-content .form-detail .form-group {
  display: flex;
  display: -webkit-flex;
  margin:  0 -8px;
}
.form-v4-content .form-detail .form-row {
  width: 100%;
  position: relative;
}
.form-v4-content .form-detail .form-group .form-row.form-row-1 {
  width: 50%;
  padding: 0 8px;
}
.form-v4-content .form-detail .form-group .form-row.form-row-2 {
  width: 100%;
  padding: 0 8px;
}
.form-v4-content .form-detail label {
  font-weight: 600;
  font-size: 15px;
  color: #666;
  display: block;
  margin-bottom: 8px;
}
.form-v4-content .form-detail .form-row label#valid {
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    -o-transform: translateY(-50%);
    -moz-transform: translateY(-50%);
    -ms-transform: translateY(-50%);
    -webkit-transform: translateY(-50%);
    width: 14px;
    height: 14px;
    border-radius: 50%;
    -o-border-radius: 50%;
    -ms-border-radius: 50%;
    -moz-border-radius: 50%;
    -webkit-border-radius: 50%;
    background: #53c83c;
}
.form-v4-content .form-detail .form-row label#valid::after {
  content: "";
    position: absolute;
    left: 5px;
    top: 1px;
    width: 3px;
    height: 8px;
    border: 1px solid #fff;
    border-width: 0 2px 2px 0;
    -webkit-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    -o-transform: rotate(45deg);
    -moz-transform: rotate(45deg);
    transform: rotate(45deg);
}
.form-v4-content .form-detail .input-text {
  margin-bottom: 27px;
}
.form-v4-content .form-detail .textarea {
  margin-bottom: 27px;
}
.form-v4-content .form-detail input {
  width: 100%;
    padding: 11.5px 15px;
    border: 1px solid #e5e5e5;
    border-top-left-radius: 5px;
    border-bottom-right-radius: 5px;
    appearance: unset;
    -moz-appearance: unset;
    -webkit-appearance: unset;
    -o-appearance: unset;
    -ms-appearance: unset;
    outline: none;
    -moz-outline: none;
    -webkit-outline: none;
    -o-outline: none;
    -ms-outline: none;
    font-family: 'Open Sans', sans-serif;
    font-size: 15px;
    color: #333;
    box-sizing: border-box;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    -o-box-sizing: border-box;
    -ms-box-sizing: border-box;
}
.form-v4-content .form-detail textarea {
  width: 100%;
    padding: 11.5px 15px;
    border: 1px solid #e5e5e5;
    border-top-left-radius: 5px;
    border-bottom-right-radius: 5px;
    appearance: unset;
    -moz-appearance: unset;
    -webkit-appearance: unset;
    -o-appearance: unset;
    -ms-appearance: unset;
    outline: none;
    -moz-outline: none;
    -webkit-outline: none;
    -o-outline: none;
    -ms-outline: none;
    font-family: 'Open Sans', sans-serif;
    font-size: 15px;
    color: #333;
    box-sizing: border-box;
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    -o-box-sizing: border-box;
    -ms-box-sizing: border-box;
}
.form-v4-content .form-detail .form-row input:focus {
  border: 1px solid #53c83c;
}
.form-v4-content .form-detail .form-row textarea:focus {
  border: 1px solid #53c83c;
}
.form-v4-content .form-detail .register {
  background: #3786bd;
  border-top-left-radius: 5px;
  border-bottom-right-radius: 5px;
  width: 130px;
  border: none;
  margin: 6px 0 50px 0px;
  cursor: pointer;
  color: #fff;
  font-weight: 700;
  font-size: 15px;
}
.form-v4-content .form-detail .register:hover {
  background: #2f73a3;
}
.form-v4-content .form-detail .form-row-last input {
  padding: 12.5px;
}
.form-v4-content .form-detail .form-row-last textarea {
  padding: 12.5px;
}

/* Responsive */
@media screen and (max-width: 991px) {
  .form-v4-content {
    margin: 180px 20px;
    flex-direction:  column;
    -o-flex-direction:  column;
    -ms-flex-direction:  column;
    -moz-flex-direction:  column;
    -webkit-flex-direction:  column;
  }
  .form-v4-content .form-left {
    width: auto;
    border-top-right-radius: 10px;
    border-bottom-left-radius: 0;
  }
  .form-v4-content .form-detail {
    padding: 30px 20px 30px 20px;
      width: auto;
  }
}
@media screen and (max-width: 575px) {
  .form-v4-content .form-detail .form-group {
    flex-direction: column;
    -o-flex-direction:  column;
    -ms-flex-direction:  column;
    -moz-flex-direction:  column;
    -webkit-flex-direction:  column;
    margin: 0;
  }
  .form-v4-content .form-detail .form-group .form-row.form-row-1 {
    width: 100%;
    padding:  0;
  }
}
</style>
